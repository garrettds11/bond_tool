<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bond Assessment Tool (No Build)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind (CDN mode for a quick demo) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* slider handle: pill-shaped */
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 36px; height: 18px; border-radius: 9999px;
      background: linear-gradient(180deg, #ffffff, #e6e6e6);
      border: 1px solid #bfbfbf; box-shadow: 0 1px 0 rgba(0,0,0,0.1);
      cursor: pointer; margin-top: -8px;
    }
    input[type=range]::-moz-range-thumb {
      width: 36px; height: 18px; border-radius: 9999px;
      background: linear-gradient(180deg, #ffffff, #e6e6e6);
      border: 1px solid #bfbfbf; box-shadow: 0 1px 0 rgba(0,0,0,0.1);
      cursor: pointer;
    }
    input[type=range]::-webkit-slider-runnable-track { height: 2px; border-radius: 9999px; background: #111827; }
    input[type=range]::-moz-range-track { height: 2px; border-radius: 9999px; background: #111827; }
  </style>
</head>
<body class="bg-gradient-to-b from-white to-neutral-100 text-neutral-900">
  <div id="root"></div>

  <!-- React + ReactDOM UMD -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Recharts UMD (uses D3 under the hood, bundled) -->
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <!-- Babel standalone to transpile JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo } = React;
    const {
      ResponsiveContainer, LineChart, Line, XAxis, YAxis,
      CartesianGrid, Tooltip, Legend, ReferenceLine
    } = Recharts;

    // ---------- Utilities ----------
    function priceBond({ face=1000, couponRate=0.05, ytm=0.05, years=10, freq=2 }) {
      const n = Math.max(1, Math.round(years * freq));
      const c = (couponRate * face) / freq;
      const r = ytm / freq;
      let pvC = 0;
      for (let t=1; t<=n; t++) pvC += c / Math.pow(1+r, t);
      const pvF = face / Math.pow(1+r, n);
      return pvC + pvF;
    }
    function macaulayDuration({ face=1000, couponRate=0.05, ytm=0.05, years=10, freq=2 }) {
      const n = Math.max(1, Math.round(years * freq));
      const c = (couponRate * face) / freq;
      const r = ytm / freq;
      const P = priceBond({ face, couponRate, ytm, years, freq });
      let num = 0;
      for (let t=1; t<=n; t++) {
        const tY = t / freq;
        const cf = t===n ? c + face : c;
        num += (tY * cf) / Math.pow(1+r, t);
      }
      return num / P;
    }
    function modifiedDuration(args) {
      const Dmac = macaulayDuration(args);
      const r = args.ytm / args.freq;
      return Dmac / (1 + r);
    }
    function yieldToWorstApprox({face=1000, couponRate=0.05, ytm=0.05, years=10, freq=2, callable=false, callYears=5, callPrice=1000}) {
      if (!callable) return ytm;
      const marketPrice = priceBond({ face, couponRate, ytm, years, freq });
      const n = Math.max(1, Math.round(callYears * freq));
      const c = (couponRate * face) / freq;
      let lo=-0.99, hi=1.0;
      for (let i=0;i<60;i++){
        const mid=(lo+hi)/2, r=mid;
        let pv=0; for (let t=1;t<=n;t++) pv += c/Math.pow(1+r,t);
        pv += callPrice/Math.pow(1+r,n);
        if (pv > marketPrice) lo = mid; else hi = mid;
      }
      const rMid=(lo+hi)/2;
      const ytc = Math.max(-0.99, Math.pow(1+rMid, freq)-1);
      return Math.min(ytm, ytc);
    }
    const fmtPct = v => (v*100).toFixed(2) + "%";
    const fmtMoney = v => v.toLocaleString(undefined, { style:"currency", currency:"USD", maximumFractionDigits:2 });

    // ---------- Controls ----------
    function LabeledSlider({ label, min, max, step, value, onChange, suffix="", toFixed=2 }) {
      return (
        <div className="w-full">
          <div className="flex items-end justify-between mb-1">
            <label className="text-sm font-medium text-neutral-800">{label}</label>
            <div className="flex items-center gap-2">
              <input
                className="w-28 px-2 py-1 rounded-md border border-neutral-300 bg-white/90 text-right focus:outline-none focus:ring-2 focus:ring-indigo-500"
                type="number" step={step} min={min} max={max}
                value={value} onChange={e=>onChange(Number(e.target.value))} />
              <span className="text-xs text-neutral-600 select-none">{suffix}</span>
            </div>
          </div>
          <div className="py-2">
            <input
              type="range" className="w-full appearance-none h-2 bg-neutral-200 rounded-full outline-none"
              min={min} max={max} step={step} value={value}
              onChange={e=>onChange(Number(e.target.value))} />
          </div>
        </div>
      );
    }
    function Checkbox({ label, checked, onChange }) {
      return (
        <label className={`flex items-center gap-2 px-3 py-2 rounded-xl border cursor-pointer transition select-none ${checked ? "border-indigo-500 bg-indigo-50" : "border-neutral-300 hover:bg-neutral-100"}`}>
          <input type="checkbox" className="accent-indigo-600" checked={checked} onChange={e=>onChange(e.target.checked)} />
          <span className="text-sm">{label}</span>
        </label>
      );
    }
    function MetricCard({ title, value, subtitle }) {
      return (
        <div className="bg-white/80 rounded-2xl border border-neutral-200 p-4 shadow-[0_8px_30px_rgb(0,0,0,0.04)]">
          <div className="text-sm text-neutral-600">{title}</div>
          <div className="mt-1 text-2xl font-semibold tracking-tight">{value}</div>
          {subtitle && <div className="mt-1 text-xs text-neutral-500">{subtitle}</div>}
        </div>
      );
    }

    // ---------- App ----------
    function BondAssessmentTool() {
      const [face, setFace] = useState(1000);
      const [couponPct, setCouponPct] = useState(5.0);
      const [ytmPct, setYtmPct] = useState(5.0);
      const [years, setYears] = useState(10);
      const [freq, setFreq] = useState(2);
      const [bondType, setBondType] = useState("corporate");
      const [callable, setCallable] = useState(false);
      const [putable, setPutable] = useState(false);
      const [sinking, setSinking] = useState(false);
      const [convertible, setConvertible] = useState(false);

      const computed = useMemo(() => {
        const couponRate = couponPct / 100;
        const ytm = ytmPct / 100;
        const base = { face, couponRate, ytm, years, freq };
        const price = priceBond(base);
        const Dmac = macaulayDuration(base);
        const Dmod = modifiedDuration(base);
        const cy = (couponRate * face) / price;
        const ytw = yieldToWorstApprox({
          face, couponRate, ytm, years, freq,
          callable, callYears: Math.min(years, Math.max(2, Math.round(years/2))), callPrice: face
        });
        const points = [];
        for (let bps=-200; bps<=200; bps+=10) {
          const y = Math.max(0.0001, ytm + bps/10000);
          const p = priceBond({ face, couponRate, ytm:y, years, freq });
          let pCallable = p;
          if (callable) {
            const ytwGrid = yieldToWorstApprox({ face, couponRate, ytm:y, years, freq, callable, callYears: Math.min(years, Math.max(2, Math.round(years/2))), callPrice: face });
            pCallable = priceBond({ face, couponRate, ytm: ytwGrid, years, freq });
          }
          points.push({ yld: y*100, Price: p, "Price (Callable est)": pCallable });
        }
        return { price, Dmac, Dmod, cy, ytw, points };
      }, [face, couponPct, ytmPct, years, freq, callable]);

      return (
        <div className="max-w-7xl mx-auto px-6 py-8">
          <h1 className="text-2xl md:text-3xl font-semibold tracking-tight">Bond Assessment Tool</h1>

          <div className="mt-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
            <section className="lg:col-span-5 bg-white/80 rounded-2xl border border-neutral-200 p-5 shadow-[0_8px_30px_rgb(0,0,0,0.04)]">
              <h2 className="text-lg font-semibold mb-4">Inputs</h2>
              <div className="space-y-5">
                <LabeledSlider label="Face Value" min={100} max={10000} step={50} value={face} onChange={setFace} suffix="USD" />
                <LabeledSlider label="Coupon Rate" min={0} max={15} step={0.1} value={couponPct} onChange={setCouponPct} suffix="%" />
                <LabeledSlider label="Yield to Maturity" min={0} max={20} step={0.1} value={ytmPct} onChange={setYtmPct} suffix="%" />
                <LabeledSlider label="Years to Maturity" min={0.5} max={40} step={0.5} value={years} onChange={setYears} suffix="yrs" />

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <div className="text-sm font-medium mb-2">Bond Type</div>
                    <div className="flex flex-wrap gap-2">
                      {[
                        { id: "treasury", label: "Treasury" },
                        { id: "corporate", label: "Corporate" },
                        { id: "muni", label: "Municipal" },
                      ].map(o => (
                        <label key={o.id} className={`px-3 py-1.5 rounded-full border text-sm cursor-pointer select-none transition ${bondType===o.id?"border-indigo-500 bg-indigo-50":"border-neutral-300 hover:bg-neutral-100"}`}>
                          <input type="radio" name="bondType" className="hidden" checked={bondType===o.id} onChange={()=>setBondType(o.id)} />
                          {o.label}
                        </label>
                      ))}
                    </div>
                  </div>
                  <div>
                    <div className="text-sm font-medium mb-2">Coupon Frequency</div>
                    <div className="flex flex-wrap gap-2">
                      {[{id:1,label:"Annual"},{id:2,label:"Semi"},{id:4,label:"Quarterly"},{id:12,label:"Monthly"}].map(o=>(
                        <label key={o.id} className={`px-3 py-1.5 rounded-full border text-sm cursor-pointer select-none transition ${freq===o.id?"border-indigo-500 bg-indigo-50":"border-neutral-300 hover:bg-neutral-100"}`}>
                          <input type="radio" name="freq" className="hidden" checked={freq===o.id} onChange={()=>setFreq(o.id)} />
                          {o.label}
                        </label>
                      ))}
                    </div>
                  </div>
                </div>

                <div>
                  <div className="text-sm font-medium mb-2">Optional Provisions</div>
                  <div className="grid grid-cols-2 gap-2">
                    <Checkbox label="Callable" checked={callable} onChange={setCallable}/>
                    <Checkbox label="Putable" checked={putable} onChange={setPutable}/>
                    <Checkbox label="Sinking Fund" checked={sinking} onChange={setSinking}/>
                    <Checkbox label="Convertible" checked={convertible} onChange={setConvertible}/>
                  </div>
                  <p className="mt-2 text-xs text-neutral-600">Note: Callable pricing is approximated via a yield-to-worst estimate using a midpoint call date.</p>
                </div>
              </div>
            </section>

            <section className="lg:col-span-7 space-y-6">
              <div className="bg-white/80 rounded-2xl border border-neutral-200 p-5 shadow-[0_8px_30px_rgb(0,0,0,0.04)]">
                <h2 className="text-lg font-semibold mb-4">Price vs Yield Comparison</h2>
                <div className="h-[340px]">
                  <ResponsiveContainer width="100%" height="100%">
                    <LineChart data={computed.points} margin={{ top: 10, right: 20, bottom: 10, left: 0 }}>
                      <CartesianGrid strokeDasharray="3 3" opacity={0.25} />
                      <XAxis dataKey="yld" tickFormatter={(v)=>`${v.toFixed(2)}%`} label={{ value: "Yield (%)", position: "insideBottom", dy: 12 }} />
                      <YAxis yAxisId="left" tickFormatter={(v)=>`$${Math.round(v)}`} label={{ value: "Price ($)", angle: -90, position: "insideLeft" }} />
                      <Tooltip formatter={(val, name) => [fmtMoney(Number(val)), name]} labelFormatter={(l)=>`Yield: ${l.toFixed(2)}%`} />
                      <Legend />
                      <ReferenceLine yAxisId="left" y={face} stroke="#10b981" strokeDasharray="4 4" label={{ value: "Par", position: "insideTopLeft", fill: "#10b981" }} />
                      <Line yAxisId="left" type="monotone" dataKey="Price" stroke="#4f46e5" strokeWidth={2.5} dot={false} name="Price (Non-call)" />
                      {callable && <Line yAxisId="left" type="monotone" dataKey="Price (Callable est)" stroke="#ef4444" strokeWidth={2} dot={false} name="Price (Callable est)" />}
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <MetricCard title="Model Price" value={fmtMoney(computed.price)} subtitle={`at YTM ${ytmPct.toFixed(2)}%, ${freq}x/yr`} />
                <MetricCard title="Current Yield" value={fmtPct(computed.cy)} subtitle="Coupon / Price" />
                <MetricCard title="Macaulay Duration" value={`${computed.Dmac.toFixed(2)} yrs`} subtitle="Interest-rate sensitivity (time-weighted)" />
                <MetricCard title="Modified Duration" value={`${computed.Dmod.toFixed(2)} yrs`} subtitle="Approx. %ΔPrice for 1% ΔYTM" />
                {callable && <MetricCard title="Yield to Worst (est)" value={`${(computed.ytw*100).toFixed(2)}%`} subtitle="Callable approximation" />}
              </div>
            </section>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<BondAssessmentTool />);
  </script>
</body>
</html>
